from flask import Flask, request, redirect, url_for, session, render_template_string
from werkzeug.security import generate_password_hash, check_password_hash

app = Flask(__name__)
app.secret_key = "supersecretkey"

# In-memory database
users = {}

# HTML Layout
base = """
<!DOCTYPE html>
<html>
<head>
    <title>Simple Auth</title>
    <style>
        body { font-family: Arial, sans-serif; background: #eef2f3; }
        .container { width: 400px; margin: 100px auto; background: #fff;
                     padding: 20px; border-radius: 8px;
                     box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        input, button { padding: 10px; margin: 5px 0; width: 100%; }
        h2 { text-align: center; }
        .msg { color: red; text-align: center; }
        a { text-decoration: none; }
    </style>
</head>
<body>
<div class="container">
    {{content}}
</div>
</body>
</html>
"""

@app.route("/")
def home():
    if "user" in session:
        return redirect(url_for("dashboard"))
    return redirect(url_for("login"))

@app.route("/register", methods=["GET", "POST"])
def register():
    msg = ""
    if request.method == "POST":
        username = request.form["username"]
        password = request.form["password"]
        if username in users:
            msg = "‚ö†Ô∏è Username already exists!"
        else:
            users[username] = generate_password_hash(password)
            return redirect(url_for("login"))
    return render_template_string(base, content=f"""
        <h2>Register</h2>
        <form method="POST">
            <input type="text" name="username" placeholder="Username" required>
            <input type="password" name="password" placeholder="Password" required>
            <button type="submit">Register</button>
        </form>
        <p class="msg">{msg}</p>
        <p>Already have an account? <a href='/login'>Login</a></p>
    """)

@app.route("/login", methods=["GET", "POST"])
def login():
    msg = ""
    if request.method == "POST":
        username = request.form["username"]
        password = request.form["password"]
        if username in users and check_password_hash(users[username], password):
            session["user"] = username
            return redirect(url_for("dashboard"))
        else:
            msg = "‚ùå Invalid credentials!"
    return render_template_string(base, content=f"""
        <h2>Login</h2>
        <form method="POST">
            <input type="text" name="username" placeholder="Username" required>
            <input type="password" name="password" placeholder="Password" required>
            <button type="submit">Login</button>
        </form>
        <p class="msg">{msg}</p>
        <p>No account? <a href='/register'>Register here</a></p>
    """)

@app.route("/dashboard")
def dashboard():
    if "user" not in session:
        return redirect(url_for("login"))
    return render_template_string(base, content=f"""
        <h2>Welcome, {session['user']} üéâ</h2>
        <p>This is a secure page only visible to logged-in users.</p>
        <a href='/logout'><button>Logout</button></a>
    """)

@app.rout
